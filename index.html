<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hostel Data</title>
  <style>
    /* Add your CSS styles here */
  </style>
</head>
<body>

  <div class="container">
    <label for="citySelect">Select City:</label>
    <select id="citySelect">
      <option value="">--Select a City--</option>
    </select>

    <label for="areaSelect">Select Area:</label>
    <select id="areaSelect" disabled>
      <option value="">--Select an Area--</option>
    </select>

    <button id="fetchButton">Fetch Data</button>
  </div>

  <div class="boxes-container" id="hostelBoxes"></div>

  <div id="pagination"></div>

  <script>
    const apiUrl = 'YOUR_API_ENDPOINT_HERE'; // Replace with your API endpoint
    let currentCity = '';
    let currentArea = '';
    let currentPage = 1;
    const rowsPerPage = 100;

    // Fetch list of cities on page load
    fetch(`${apiUrl}?getCities=true`)
      .then(response => response.json())
      .then(data => {
        const citySelect = document.getElementById('citySelect');
        data.cities.forEach(city => {
          const option = document.createElement('option');
          option.value = city;
          option.textContent = city;
          citySelect.appendChild(option);
        });
      });

    // Fetch areas based on selected city
    document.getElementById('citySelect').addEventListener('change', function() {
      currentCity = this.value;
      const areaSelect = document.getElementById('areaSelect');
      areaSelect.innerHTML = '<option value="">--Select an Area--</option>'; // Reset area options
      areaSelect.disabled = true; // Disable area select until city is selected
      
      if (currentCity) {
        console.log(`Fetching areas for city: ${currentCity}`); // Log selected city
        fetch(`${apiUrl}?getAreas=true&city=${currentCity}`)
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            console.log('Areas fetched:', data); // Log fetched areas
            data.areas.forEach(area => {
              const option = document.createElement('option');
              option.value = area;
              option.textContent = area;
              areaSelect.appendChild(option);
            });
            areaSelect.disabled = false; // Enable area select after fetching areas
          })
          .catch(error => {
            console.error('Error fetching areas:', error);
          });
      }
    });

    // Fetch and display hostel data based on city, area, and pagination
    function fetchHostelData(city, area, page) {
      fetch(`${apiUrl}?city=${city}&area=${area}&page=${page}`)
        .then(response => response.json())
        .then(data => {
          const boxesContainer = document.getElementById('hostelBoxes');
          boxesContainer.innerHTML = '';

          if (data.data.length === 0) {
            boxesContainer.innerHTML = '<p>No hostels found for this city and area.</p>';
            document.getElementById('pagination').innerHTML = ''; // Clear pagination
            return;
          }

          data.data.forEach((row, index) => {
            const phoneNumberFormatted = row.phoneNumber.replace(/\D/g, ''); // Format the phone number for WhatsApp
            const box = document.createElement('div');
            box.classList.add('box');
            box.innerHTML = `
              <p><strong>S.No:</strong> ${(page - 1) * rowsPerPage + index + 1}</p>
              <p><strong>Hostel Name:</strong> ${row.hostelName}</p>
              <p><strong>Area:</strong> ${row.area}</p>
              <p><strong>City:</strong> ${row.cityName}</p>
              <a href="tel:${row.phoneNumber}" class="call-button">Call Now</a>
              <a href="https://wa.me/${phoneNumberFormatted}" class="whatsapp-button">WhatsApp</a>
            `;
            boxesContainer.appendChild(box);
          });

          setupPagination(data.total, page);
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    }

    // Fetch data when button is clicked
    document.getElementById('fetchButton').addEventListener('click', function() {
      currentArea = document.getElementById('areaSelect').value;
      if (currentCity && currentArea) {
        fetchHostelData(currentCity, currentArea, currentPage);
      } else {
        alert('Please select both a city and an area.');
      }
    });
  </script>
</body>
</html>
